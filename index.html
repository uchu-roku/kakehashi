<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KAKEHASHI | 衛星データ活用診断（入口）</title>
  <style>
    :root {
      --bg: #0b1020;
      --card: #131a33;
      --text: #e7ecff;
      --muted: #9fb1ffcc;
      --accent: #5b8cff;
      --accent2: #6ee7b7;
      --border: #243058;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
      background: radial-gradient(1000px 600px at 10% -10%, #18224b 0%, var(--bg) 60%);
      color: var(--text);
      line-height: 1.6;
    }
    header {
      padding: 28px 20px 10px;
    }
    .container { max-width: 980px; margin: 0 auto; padding: 0 20px 60px; }
    .title { font-size: 28px; font-weight: 800; letter-spacing: .5px; }
    .subtitle { color: var(--muted); margin-top: 6px; }
    .card {
      background: linear-gradient(180deg, #151c3a, #101735);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 22px;
      margin-top: 18px;
      box-shadow: 0 8px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.05);
    }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
    label { font-weight: 700; font-size: 14px; color: var(--muted); display:block; margin-bottom:8px; }
    select, textarea, input[type="text"] {
      width: 100%; background: #0f1530; color: var(--text);
      border: 1px solid var(--border); border-radius: 12px; padding: 12px 14px;
      outline: none; font-size: 15px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.03);
    }
    textarea { min-height: 110px; resize: vertical; }
    .hint { font-size: 12px; color: var(--muted); margin-top: 6px; }
    .btnbar { display:flex; gap:12px; align-items:center; flex-wrap: wrap; }
    .btn {
      appearance: none; border: 0; border-radius: 14px;
      padding: 12px 18px; font-weight: 800; letter-spacing: .2px;
      cursor: pointer; transition: transform .06s ease;
      background: linear-gradient(180deg, var(--accent), #3b5ef0);
      color: white; box-shadow: 0 8px 20px rgba(59,94,240,.35);
    }
    .btn.secondary {
      background: linear-gradient(180deg, #1e293b, #0f172a);
      color: var(--text); border: 1px solid var(--border);
      box-shadow: none;
    }
    .btn:active { transform: translateY(1px); }
    .pill {
      display:inline-flex; align-items:center; gap:8px; padding: 4px 10px;
      border:1px dashed var(--border); border-radius: 999px; color: var(--muted);
      font-size: 12px;
    }
    .footer { margin-top: 16px; color: var(--muted); font-size: 12px; }
    .badges { display:flex; gap:8px; flex-wrap: wrap; }
    .tag { padding: 6px 10px; border-radius: 999px; background:#0f1733; border:1px solid var(--border); font-size:12px; color:#b7c7ff; }
  </style>
</head>
<body>
  <header class="container">
    <div class="title">KAKEHASHI｜衛星データ活用診断</div>
    <div class="subtitle">業界とビジネス課題から、あなたに合うデモ事例をおすすめします。</div>
  </header>

  <main class="container">
    <section class="card">
      <div class="badges">
        <span class="pill">v2 (cases-db.json対応)</span>
        <span class="tag">Industry × Business Need</span>
        <span class="tag">自然文入力OK</span>
        <span class="tag">KPI任意</span>
      </div>

      <div class="grid" style="margin-top: 16px;">
        <div>
          <label for="industry">業界（Industry）</label>
          <select id="industry">
            <option value="">— 選択してください —</option>
          </select>
          <div class="hint">cases-db.json から自動抽出</div>
        </div>
        <div>
          <label for="need">一般的なビジネス課題（Business Need）</label>
          <select id="need">
            <option value="">— 選択してください —</option>
          </select>
          <div class="hint">例：コスト削減 / 品質向上 / 労務省力化 / 安全・リスク低減 / 進捗可視化 / ESG/CO2対応</div>
        </div>
      </div>

      <div class="grid" style="margin-top: 16px;">
        <div>
          <label for="keywords">自由記述（任意）</label>
          <input id="keywords" type="text" placeholder="例：法面変位を早期検知したい、漁場探索の燃料を減らしたい…">
          <div class="hint">あなたの言葉で課題を書いてください。結果の並び順に反映されます。</div>
        </div>
        <div>
          <label for="kpi">重視するKPI（任意）</label>
          <select id="kpi">
            <option value="">— 指標を選択（任意） —</option>
            <option value="コスト">コスト削減</option>
            <option value="品質">品質向上</option>
            <option value="工数">工数・省力化</option>
            <option value="安全">安全・リスク</option>
            <option value="進捗">進捗可視化</option>
            <option value="ESG">ESG/CO2</option>
          </select>
          <div class="hint">KPIは並び替えやハイライトの参考にします。</div>
        </div>
      </div>

      <div class="footer">
        入力は匿名で処理されます。送信すると <code>results.html</code> に遷移します。
      </div>
      <div class="btnbar" style="margin-top: 16px;">
        <button class="btn" id="submitBtn">デモを探す</button>
        <button class="btn secondary" id="resetBtn">リセット</button>
      </div>
    </section>

    <section class="card">
      <div style="font-weight:800; margin-bottom:8px;">プレビュー（該当件数と例）</div>
      <div id="preview" class="hint">cases-db.json を読み込み中…</div>
    </section>
  </main>

  <script>
    const state = {
      cases: [],
      industries: new Set(),
      needs: new Set(),
    };

    // Load cases-db.json and populate selectors
    async function loadCases() {
      try {
        const res = await fetch('cases-db.json', { cache: 'no-store' });
        const data = await res.json();
        state.cases = data;

        // Collect unique industries & needs
        data.forEach(item => {
          if (item.industry) state.industries.add(item.industry);
          if (item.business_need) state.needs.add(item.business_need);
        });

        // Populate selectors
        const indSel = document.getElementById('industry');
        [...state.industries].sort().forEach(v => {
          const opt = document.createElement('option');
          opt.value = v; opt.textContent = v;
          indSel.appendChild(opt);
        });

        const needSel = document.getElementById('need');
        [...state.needs].sort().forEach(v => {
          const opt = document.createElement('option');
          opt.value = v; opt.textContent = v;
          needSel.appendChild(opt);
        });

        renderPreview();
      } catch (e) {
        document.getElementById('preview').textContent = 'cases-db.json の読み込みに失敗しました。配置パスをご確認ください。';
        console.error(e);
      }
    }

    function filterCases() {
      const industry = document.getElementById('industry').value.trim();
      const need = document.getElementById('need').value.trim();
      const q = document.getElementById('keywords').value.trim();

      const kw = q ? q.toLowerCase() : '';

      return state.cases.filter(c => {
        const okIndustry = !industry || c.industry === industry;
        const okNeed = !need || c.business_need === need;
        const okKw = !kw || (
          (c.problem && c.problem.toLowerCase().includes(kw)) ||
          (c.solution && c.solution.toLowerCase().includes(kw)) ||
          (c.kpi && c.kpi.toLowerCase().includes(kw))
        );
        return okIndustry && okNeed && okKw;
      });
    }

    function renderPreview() {
      const list = filterCases();
      const box = document.getElementById('preview');
      if (!list.length) {
        box.innerHTML = '該当する事例がまだありません。条件を調整してください。';
        return;
      }
      // show top 3
      const top = list.slice(0, 3);
      const html = [`<div>該当 <b>${list.length}</b> 件</div>`]
        .concat(top.map(c => `
        <div style="margin-top:10px;padding:10px;border:1px solid var(--border);border-radius:10px;background:#0e1533;">
          <div style="font-weight:700">${c.industry} × ${c.business_need}</div>
          <div style="margin-top:6px"><b>課題:</b> ${c.problem}</div>
          <div><b>解決:</b> ${c.solution}</div>
          <div style="color:var(--muted);font-size:12px;margin-top:4px;">KPI: ${c.kpi}</div>
        </div>`)).join('');
      box.innerHTML = html;
    }

    // Wire events
    ['industry','need','keywords','kpi'].forEach(id => {
      document.addEventListener('change', (e) => {
        if (e.target && e.target.id === id) renderPreview();
      }, true);
      document.addEventListener('input', (e) => {
        if (e.target && e.target.id === id) renderPreview();
      }, true);
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
      document.getElementById('industry').value = '';
      document.getElementById('need').value = '';
      document.getElementById('keywords').value = '';
      document.getElementById('kpi').value = '';
      renderPreview();
    });

    document.getElementById('submitBtn').addEventListener('click', () => {
      const industry = encodeURIComponent(document.getElementById('industry').value.trim());
      const need = encodeURIComponent(document.getElementById('need').value.trim());
      const q = encodeURIComponent(document.getElementById('keywords').value.trim());
      const kpi = encodeURIComponent(document.getElementById('kpi').value.trim());
      const url = `results.html?industry=${industry}&need=${need}&q=${q}&kpi=${kpi}`;
      window.location.href = url;
    });

    loadCases();
  </script>
</body>
</html>
